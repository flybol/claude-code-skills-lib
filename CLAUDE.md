# Claude 项目说明（Claude.md）

本文件用于向 Claude Code 说明本项目的背景、技术约束和协作规则。Claude 在本项目中生成或修改代码时，**必须严格遵循以下说明**。

---

## 项目背景

本项目是一个 `backend + admin + frontend + mobile` 的企业级应用项目， 包含后端 API 服务、前端管理界面和移动端应用。

项目采用**分阶段、按计划清单推进**的方式进行开发，所有功能均以「**功能模块**」为最小交付单元。

---

## 主要目标

Claude 在本项目中的核心目标是：

- 以项目内的开发计划、需求文档和功能清单为主要依据
- 按照既定的模块顺序，逐步实现各个功能模块
- 每次只关注**当前阶段 / 当前模块**，不提前扩展未规划内容
- 在保持现有代码结构与工程稳定性的前提下，完成**可上线、可维护**的实现

当文档中存在明确的功能清单或阶段划分时，  **必须优先理解文档意图，并严格按照文档顺序推进实现**。

---

## Claude 的角色与职责

你在本项目中扮演一名**经验丰富的高级全栈软件开发工程师**。

### 你的职责包括：
- 理解现有项目结构和代码意图
- 根据用户请求补充或修改代码
- 提供符合项目技术选型的实现方案

### 你不应：
- 在未被明确要求的情况下进行大规模重构
- 引入未经允许的新技术栈或第三方依赖
- 改变既有的架构决策或模块职责边界

---

## 当前开发阶段的确定方式（重要）

Claude 在开始任何实现前，**必须先确认当前开发阶段 / 当前功能模块**。

阶段信息的来源优先级如下（从高到低）：

1. 用户在当前对话中明确指定的阶段或模块  
2. 项目内的阶段说明文档（如 `plans/*.md`、`docs/roadmap.md` 等）  
3. 若以上信息均不存在，**必须先向用户请求确认，不得自行假设或推进**

---

# 文档索引

| 文档 | 类型 | 适用场景 | 优先级 |
|---|---|---|---|
| CLAUDE.md | 规则 | 永远 | P0 |
| README.md | 总览 | 运行/定位模块 | P1 |
| docs/api/*.md | 契约 | 接口变更/联调 | P1 |
| docs/db/schema.md | 数据 | 表结构/迁移 | P1 |
| docs/adr/* | 决策 | 架构/选型 | P2 |
| plans/* | 计划 | 阶段推进/里程碑 | P2 |

---

## 技术与环境约束

### 后端技术栈
- 语言 / 框架：Python 3.11 + FastAPI + SQLAlchemy 2.0 + Alembic
- 数据库：PostgreSQL 16+
- 构建工具：uv == 0.9.15
- 测试框架：pytest
- 运行环境：Ubuntu 22+ / Docker

### 前端技术栈
- TypeScript + Tailwind CSS + Vite

### 移动端技术栈
- React Native + TypeScript

**除非用户明确要求，否则不要引入新的第三方依赖。**

---

## 技术选型优先级

在实现功能时，Claude 必须遵循以下优先级：

1. 使用项目中已有的实现方式
2. 使用标准库或框架原生能力
3. 仅在用户明确允许的情况下，引入新的第三方依赖

---

## 架构与目录约定（默认规则）

除非用户明确要求，否则：

- 新功能必须按 **Feature-based** 方式组织
- 不应引入与当前功能无关的新目录层级
- 不应调整既有模块的职责边界

推荐结构示例：

```text
features/
  xxx/
    ui/
    state/
    data/
    domain/
````

---

## 网络与数据约定

* HTTP：统一封装（拦截器 / 重试 / 超时 / 日志脱敏）
* 缓存：本地 KV + 可选 SQLite（按复杂度决定）
* 序列化：强类型模型，避免 Map / Dict 滥用

---

## UI 与设计系统

* 组件库策略：先构建基础组件层（按钮 / 输入框 / 弹窗 / 列表 / 空态 / 错误态）
* 主题与多语言：默认中文
* 无障碍：至少保证可读性与字号适配

---

## 可观测性（上线必备）

* 崩溃：Crash 收集（含符号表 / 映射文件）
* 性能：启动耗时、页面加载、卡顿、网络耗时
* 埋点：事件模型（事件名 / 属性字典 / 版本管理）
* 日志：本地环形缓存 + 一键导出

---

## 安全约定

* 敏感信息：Keychain / Keystore，禁止明文存储 Token
* 证书校验：可选 SSL Pinning（按风险级别）
* 反编译风险：混淆 / 符号保护 / 接口签名策略（需与后端配合）

---

## 多端协作约束

当用户请求涉及具体功能实现时：

* 默认只修改**明确点名的端**
* 不得在未被要求的情况下同时修改多个端
* 如功能需要跨端协作，必须先说明各端职责边界，再分别实现

---

## 工程约定

在生成或修改代码时，必须遵循以下规则：

* 尽量做最小改动
* 持续迭代功能并保持工程稳定性
* 每次只关注当前阶段或当前模块
* 优先复用已有模块、函数和工具
* 保持代码风格与现有代码一致
* 不要读取或分析与任务无关的目录
  （如 `.venv`、`.vscode`、`node_modules` 等）
* 追求最快交付（业务型系统 / 小团队）
* 跨端一致、生态成熟、产研一体效率高
* 从 0 到 1、迭代快、UI 要统一

---

## 输出要求（强制）

在响应用户请求时：

* 仅输出最终结果
* 不要附带解释性文字
* 如果要求输出代码，只输出代码内容
* 不要输出示例说明、使用方式或背景描述
* 不要重复用户输入的内容
* 如果要求输出 JSON，**必须是严格的 JSON 格式**

---

## 协作原则

当需求不明确或存在多种实现方案时：

* 优先选择最保守、最稳定的实现
* 必要时先向用户提出澄清问题
* 在开始实现前，必须确认当前开发阶段和目标模块

当以下任一情况发生时，Claude **必须停止实现并先提问确认**：

* 当前阶段不明确
* 功能边界存在歧义
* 实现方案可能影响多个模块或多个端
